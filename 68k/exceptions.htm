<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Exception Vector Processing - GForce Programming</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<meta name="ROBOTS" content="ALL" />
<link rel="stylesheet" type="text/css" href="../templates/GForce_Calc/style.css" />

</head>
<body leftmargin="0" topmargin="0" rightmargin="0" bgcolor="black" text="#008000" vlink="#008000" link="#008000" alink="#008000">
<table width="100%" border="0" bordercolor="black" cellpadding="5" cellspacing="0">
  <tr>
    <td height="50" valign="middle" colspan="6" align="left">
      <center>
        <a href="../index.html"><img src="../templates/GForce_Calc/logo.gif" alt="GForce Programming" width="508" height="43" border="0"/></a>
      </center>
    </td>
  </tr>
  <table border="1" bordercolor="gray" align="center" width="100%">
    <tr align="center" bgcolor="black" bordercolor="gray">
      <td><a class="menu" href="../index.html">&nbsp;&nbsp;Home&nbsp;&nbsp;</a></td>
      <td><a class="menu" href="index.html">&nbsp;&nbsp;Greg's 68k Programming Reference&nbsp;&nbsp;</a></td>
      <td><a class="menu" href="http://www.ticalc.org/archives/files/authors/33/3317.html">&nbsp;&nbsp;ticalc.org Author Profile&nbsp;&nbsp;</a></td>
      <td><a class="menu" href="http://www.detachedsolutions.com/">&nbsp;&nbsp;Detached Solutions&nbsp;&nbsp;</a></td>
      <td><a class="menu" href="../old_news.htm">&nbsp;&nbsp;Really Old News&nbsp;&nbsp;</a></td>
    </tr>
  </table>
</table>
<br />
<table width="100%" cellpadding="0" cellspacing="0">
  <tr>
    <td>
      <table width="100%" border="0">
        <tr>
          <td width="5">
            <!-- spacer column -->
          </td>
          <td width="*" valign="top"> <h1>Exception Vector Processing</h1>

<p>ABOUT<br>
<br>
The 68000 processor used by the TI-89 keeps a #1024 byte vector table beginning at
$000000. This table contains pointers to routines used by the cpu, operating system, and
the user. The vectors are refered to with an index from #0 through #255. This document
describes some of these vectors as they relate to the AMS.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </p>

<table border="1" width="100%" height="719">
  <tr>
    <td width="101%" colspan="4" height="19"><p align="center"><strong>Exception Vector
    Assignment Table</strong></td>
  </tr>
  <tr>
    <td width="9%" align="center" height="38"><strong>Address</strong></td>
    <td width="63%" align="center" height="38"><strong>Vector Function</strong></td>
    <td width="17%" align="center" height="38"><strong>Vector # (Decimal)</strong></td>
    <td width="18%" height="38"><p align="center"><strong>Vector # (Hexadecimal)</strong></td>
  </tr>
  <tr>
    <td width="9%" height="19">$000</td>
    <td width="63%" height="19">Reset Vector - Contains initial SSP &amp; PC</td>
    <td width="17%" height="19">0</td>
    <td width="18%" height="19">$0</td>
  </tr>
  <tr>
    <td width="9%" height="19">$008</td>
    <td width="63%" height="19">Bus Error</td>
    <td width="17%" height="19">2</td>
    <td width="18%" height="19">$2</td>
  </tr>
  <tr>
    <td width="9%" height="19">$00C</td>
    <td width="63%" height="19">Address Error</td>
    <td width="17%" height="19">3</td>
    <td width="18%" height="19">$3</td>
  </tr>
  <tr>
    <td width="9%" height="19">$010</td>
    <td width="63%" height="19">Illegal Instruction</td>
    <td width="17%" height="19">4</td>
    <td width="18%" height="19">$4</td>
  </tr>
  <tr>
    <td width="9%" height="19">$014</td>
    <td width="63%" height="19">Zero Divide</td>
    <td width="17%" height="19">5</td>
    <td width="18%" height="19">$5</td>
  </tr>
  <tr>
    <td width="9%" height="19">$018</td>
    <td width="63%" height="19">CHK Instruction</td>
    <td width="17%" height="19">6</td>
    <td width="18%" height="19">$6</td>
  </tr>
  <tr>
    <td width="9%" height="19">$01C</td>
    <td width="63%" height="19">TRAPV Instruction</td>
    <td width="17%" height="19">7</td>
    <td width="18%" height="19">$7</td>
  </tr>
  <tr>
    <td width="9%" height="19">$020</td>
    <td width="63%" height="19">Privilege Violation</td>
    <td width="17%" height="19">8</td>
    <td width="18%" height="19">$8</td>
  </tr>
  <tr>
    <td width="9%" height="19">$024</td>
    <td width="63%" height="19">Trace</td>
    <td width="17%" height="19">9</td>
    <td width="18%" height="19">$9</td>
  </tr>
  <tr>
    <td width="9%" height="19">$028</td>
    <td width="63%" height="19"><a href="http://calc.gregd.org/index.html#1010">Line 1010 Emulator</a></td>
    <td width="17%" height="19">10</td>
    <td width="18%" height="19">$A</td>
  </tr>
  <tr>
    <td width="9%" height="19">$02C</td>
    <td width="63%" height="19"><a href="http://calc.gregd.org/index.html#1111">Line 1111 Emulator</a></td>
    <td width="17%" height="19">11</td>
    <td width="18%" height="19">$B</td>
  </tr>
  <tr>
    <td width="9%" height="19">$030</td>
    <td width="63%" height="19">Unassigned: Reserved by Motorola</td>
    <td width="17%" height="19">12-14 </td>
    <td width="18%" height="19">$C-$E</td>
  </tr>
  <tr>
    <td width="9%" height="19">$03C</td>
    <td width="63%" height="19">Uninitialized Interrupt Vector</td>
    <td width="17%" height="19">15</td>
    <td width="18%" height="19">$F</td>
  </tr>
  <tr>
    <td width="9%" height="19">$040</td>
    <td width="63%" height="19">Unassigned: Reserved by Motorola</td>
    <td width="17%" height="19">16-23</td>
    <td width="18%" height="19">$10-$17</td>
  </tr>
  <tr>
    <td width="9%" height="19">$060</td>
    <td width="63%" height="19">Spurious Interrupt</td>
    <td width="17%" height="19">24</td>
    <td width="18%" height="19">$18</td>
  </tr>
  <tr>
    <td width="9%" height="19">$064</td>
    <td width="63%" height="19"><a href="http://calc.gregd.org/index.html#Auto Interrupt 1">Level 
      1 Interrupt Autovector</a></td>
    <td width="17%" height="19">25</td>
    <td width="18%" height="19">$19</td>
  </tr>
  <tr>
    <td width="9%" height="19">$068</td>
    <td width="63%" height="19"><a href="http://calc.gregd.org/index.html#Auto Interrupt 2">Level 
      2 Interrupt Autovector</a></td>
    <td width="17%" height="19">26</td>
    <td width="18%" height="19">$1A</td>
  </tr>
  <tr>
    <td width="9%" height="19">$06C</td>
    <td width="63%" height="19"><a href="http://calc.gregd.org/index.html#Auto Interrupt 3">Level 
      3 Interrupt Autovector</a></td>
    <td width="17%" height="19">27</td>
    <td width="18%" height="19">$1B</td>
  </tr>
  <tr>
    <td width="9%" height="19">$070</td>
    <td width="63%" height="19"><a href="http://calc.gregd.org/index.html#Auto Interrupt 4">Level 
      4 Interrupt Autovector</a></td>
    <td width="17%" height="19">28</td>
    <td width="18%" height="19">$1C</td>
  </tr>
  <tr>
    <td width="9%" height="19">$074</td>
    <td width="63%" height="19"><a href="http://calc.gregd.org/index.html#Auto Interrupt 5">Level 
      5 Interrupt Autovector</a></td>
    <td width="17%" height="19">29</td>
    <td width="18%" height="19">$1D</td>
  </tr>
  <tr>
    <td width="9%" height="19">$078</td>
    <td width="63%" height="19"><a href="http://calc.gregd.org/index.html#Auto Interrupt 6">Level 
      6 Interrupt Autovector</a></td>
    <td width="17%" height="19">30</td>
    <td width="18%" height="19">$1E</td>
  </tr>
  <tr>
    <td width="9%" height="19">$07C</td>
    <td width="63%" height="19"><a href="http://calc.gregd.org/index.html#Auto Interrupt 7">Level 
      7 Interrupt Autovector</a></td>
    <td width="17%" height="19">31</td>
    <td width="18%" height="19">$1F</td>
  </tr>
  <tr>
    <td width="9%" height="19">$080</td>
    <td width="63%" height="19"><a href="exceptions.htm#Trap #0">TRAP $0&nbsp;&nbsp; (#0)</a></td>
    <td width="17%" height="19">32</td>
    <td width="18%" height="19">$20</td>
  </tr>
  <tr>
    <td width="9%" height="19">$084</td>
    <td width="63%" height="19"><a href="exceptions.htm#Trap #1">TRAP $1&nbsp;&nbsp; (#1)</a></td>
    <td width="17%" height="19">33</td>
    <td width="18%" height="19">$21</td>
  </tr>
  <tr>
    <td width="9%" height="19">$088</td>
    <td width="63%" height="19"><a href="exceptions.htm#Trap #2">TRAP $2&nbsp;&nbsp; (#2)</a></td>
    <td width="17%" height="19">34</td>
    <td width="18%" height="19">$22</td>
  </tr>
  <tr>
    <td width="9%" height="19">$08C</td>
    <td width="63%" height="19"><a href="exceptions.htm#Trap #3">TRAP $3&nbsp;&nbsp; (#3)</a></td>
    <td width="17%" height="19">35</td>
    <td width="18%" height="19">$23</td>
  </tr>
  <tr>
    <td width="9%" height="19">$090</td>
    <td width="63%" height="19"><a href="exceptions.htm#Trap #4">TRAP $4&nbsp;&nbsp; (#4)</a></td>
    <td width="17%" height="19">36</td>
    <td width="18%" height="19">$24</td>
  </tr>
  <tr>
    <td width="9%" height="19">$094</td>
    <td width="63%" height="19"><a href="exceptions.htm#Trap #5">TRAP $5&nbsp;&nbsp; (#5)</a></td>
    <td width="17%" height="19">37</td>
    <td width="18%" height="19">$25</td>
  </tr>
  <tr>
    <td width="9%" height="19">$098</td>
    <td width="63%" height="19"><a href="exceptions.htm#Trap #6&nbsp;">TRAP $6&nbsp;&nbsp; (#6)</a></td>
    <td width="17%" height="19">38</td>
    <td width="18%" height="19">$26</td>
  </tr>
  <tr>
    <td width="9%" height="19">$09C</td>
    <td width="63%" height="19"><a href="exceptions.htm#Trap #7">TRAP $7&nbsp;&nbsp; (#7)</a></td>
    <td width="17%" height="19">39</td>
    <td width="18%" height="19">$27</td>
  </tr>
  <tr>
    <td width="9%" height="19">$0A0</td>
    <td width="63%" height="19"><a href="exceptions.htm#Trap #8">TRAP $8&nbsp;&nbsp; (#8)</a></td>
    <td width="17%" height="19">40</td>
    <td width="18%" height="19">$28</td>
  </tr>
  <tr>
    <td width="9%" height="19">$0A4</td>
    <td width="63%" height="19"><a href="exceptions.htm#Trap #9">TRAP $9&nbsp;&nbsp; (#9)</a></td>
    <td width="17%" height="19">41</td>
    <td width="18%" height="19">$29</td>
  </tr>
  <tr>
    <td width="9%" height="19">$0A8</td>
    <td width="63%" height="19"><a href="exceptions.htm#Trap #10">TRAP $A&nbsp;&nbsp; (#10)</a></td>
    <td width="17%" height="19">42</td>
    <td width="18%" height="19">$2A</td>
  </tr>
  <tr>
    <td width="9%" height="19">$0AC</td>
    <td width="63%" height="19"><a href="exceptions.htm#Trap #11">TRAP $B&nbsp;&nbsp; (#11)</a></td>
    <td width="17%" height="19">43</td>
    <td width="18%" height="19">$2B</td>
  </tr>
  <tr>
    <td width="9%" height="19">$0B0</td>
    <td width="63%" height="19"><a href="exceptions.htm#Trap #12">TRAP $C&nbsp;&nbsp; (#12)</a></td>
    <td width="17%" height="19">44</td>
    <td width="18%" height="19">$2C</td>
  </tr>
  <tr>
    <td width="9%" height="19">$0B4</td>
    <td width="63%" height="19"><a href="exceptions.htm#Trap #13">TRAP $D&nbsp;&nbsp; (#13)</a></td>
    <td width="17%" height="19">45</td>
    <td width="18%" height="19">$2D</td>
  </tr>
  <tr>
    <td width="9%" height="19">$0B8</td>
    <td width="63%" height="19"><a href="exceptions.htm#Trap #14">TRAP $E&nbsp;&nbsp; (#14)</a></td>
    <td width="17%" height="19">46</td>
    <td width="18%" height="19">$2E</td>
  </tr>
  <tr>
    <td width="9%" height="19">$0BC</td>
    <td width="63%" height="19"><a href="exceptions.htm#Trap #15">TRAP $F&nbsp;&nbsp; (#15)</a></td>
    <td width="17%" height="19">47</td>
    <td width="18%" height="19">$2F</td>
  </tr>
  <tr>
    <td width="9%" height="19">$0C0</td>
    <td width="63%" height="19">Unassigned: Reserved by Motorola</td>
    <td width="17%" height="19">48-49</td>
    <td width="18%" height="19">$30-$31</td>
  </tr>
  <tr>
    <td width="9%" height="19">$0C8</td>
    <td width="63%" height="19">AMS Jump Table Pointer</td>
    <td width="17%" height="19">50</td>
    <td width="18%" height="19">$32</td>
  </tr>
  <tr>
    <td width="9%" height="19">$0CC</td>
    <td width="63%" height="19">Unassigned: Reserved by Motorola</td>
    <td width="17%" height="19">51-63</td>
    <td width="18%" height="19">$33-$3F</td>
  </tr>
  <tr>
    <td width="9%" height="19">$100</td>
    <td width="63%" height="19">User Interrupt Vectors</td>
    <td width="17%" height="19">64-25</td>
    <td width="18%" height="19">$40-$FF</td>
  </tr>
  <tr>
    <td width="9%" height="19">$400</td>
    <td width="63%" height="19">End of Exception Vector Table</td>
    <td width="17%" height="19"></td>
    <td width="18%" height="19"></td>
  </tr>
</table>

<h3><br>
<br>
VECTOR ASSIGNMENTS ON THE TI-89</h3>

<h4><br>
Line <a name="1010">1010</a> ($A) Emulator</h4>

<p>Triggered when an op code beginning with 1010 is encountered; the operating system uses
this to throw errors. The general format is $Axxx where xxx is the error code. The error
codes are the same as printed in the calculators manual. Some error codes are not
documented.</p>

<h4>Line <a name="1111">1111</a> ($F) Emulator</h4>

<p>Triggered when an op code beginning with 1111 is encountered.<br>
<br>
AMS &lt; 2.04 Print Line 1111 Emulator and Freeze.<br>
<br>
AMS =&gt;2.04 Call routine in jump table format is $F800 + JumpTableIndex.<br>
Example: ClrScr is $19E in the jump table. $F800 + $19E = $F99E. So dc.w $F99E (or .word
0xF99E 'as' style) would call ClrScr. When using this method, the call takes 2 bytes
compared to 6 bytes and is much slower than the traditional methods.</p>

<h4>Auto Interrupts 1-7</h4>

<p>The interrupt level can be set with OSSetSR or Trap #1. Setting an interrupt mask above
$500 will disable the calculator's ability to save state information if there is a power
outage.<br>
There are 8 levels of interrupts available on the TI-89:</p>

<table border="1" width="574">
  <tr>
    <th colspan="3"><h3 align="center"><a name="Interrupt Mask Settings">Interrupt Mask
    Settings</a></h3>
    </th>
  </tr>
  <tr>
    <td width="130" align="center"><a href="cpu.htm#Status Register"><strong>Interrupt Mask</strong></a></td>
    <td width="191" align="center"><strong>Short Description</strong></td>
    <td width="231" align="center"><strong>Disabled Interrupts</strong></td>
  </tr>
  <tr>
    <td width="130">$700</td>
    <td width="191">Disable All Interrupts</td>
    <td width="231">
      <p align="center"><a href="http://calc.gregd.org/index.html#Auto Interrupt Descriptions">Auto 
        Interrupts</a> <a href="http://calc.gregd.org/index.html#Auto Interrupt 1">1</a>, <a href="http://calc.gregd.org/index.html#Auto Interrupt 2">2</a>, 
        <a
    href="http://calc.gregd.org/index.html#Auto Interrupt 3">3</a>, <a href="http://calc.gregd.org/index.html#Auto Interrupt 4">4</a>, 
        <a
    href="http://calc.gregd.org/index.html#Auto Interrupt 5">5</a>, <a href="http://calc.gregd.org/index.html#Auto Interrupt 6">6</a>
    </td>
  </tr>
  <tr>
    <td width="130">$600</td>
    <td width="191">Disable ON key &amp; Below</td>
    <td width="231" align="center"><a href="http://calc.gregd.org/index.html#Auto Interrupt Descriptions">Auto 
      Interrupts</a> <a
    href="http://calc.gregd.org/index.html#Auto Interrupt 1">1</a>, <a href="http://calc.gregd.org/index.html#Auto Interrupt 2">2</a>, 
      <a
    href="http://calc.gregd.org/index.html#Auto Interrupt 3">3</a>, <a href="http://calc.gregd.org/index.html#Auto Interrupt 4">4</a>, 
      <a
    href="http://calc.gregd.org/index.html#Auto Interrupt 5">5</a>, <a href="http://calc.gregd.org/index.html#Auto Interrupt 6">6</a></td>
  </tr>
  <tr>
    <td width="130">$500</td>
    <td width="191">Disable Timers &amp; Below</td>
    <td width="231" align="center"><a href="http://calc.gregd.org/index.html#Auto Interrupt Descriptions">Auto 
      Interrupts</a> <a
    href="http://calc.gregd.org/index.html#Auto Interrupt 1">1</a>, <a href="http://calc.gregd.org/index.html#Auto Interrupt 2">2</a>, 
      <a
    href="http://calc.gregd.org/index.html#Auto Interrupt 3">3</a>, <a href="http://calc.gregd.org/index.html#Auto Interrupt 4">4</a>, 
      <a
    href="http://calc.gregd.org/index.html#Auto Interrupt 5">5</a></td>
  </tr>
  <tr>
    <td width="130">$400</td>
    <td width="191">Disable Link &amp; Below</td>
    <td width="231" align="center"><a href="http://calc.gregd.org/index.html#Auto Interrupt Descriptions">Auto 
      Interrupts</a> <a
    href="http://calc.gregd.org/index.html#Auto Interrupt 1">1</a>, <a href="http://calc.gregd.org/index.html#Auto Interrupt 2">2</a>, 
      <a
    href="http://calc.gregd.org/index.html#Auto Interrupt 3">3</a>, <a href="http://calc.gregd.org/index.html#Auto Interrupt 4">4</a></td>
  </tr>
  <tr>
    <td width="130">$300</td>
    <td width="191">Disable Slow Clock &amp; Below</td>
    <td width="231" align="center"><a href="http://calc.gregd.org/index.html#Auto Interrupt Descriptions">Auto 
      Interrupts</a> <a
    href="http://calc.gregd.org/index.html#Auto Interrupt 1">1</a>, <a href="http://calc.gregd.org/index.html#Auto Interrupt 2">2</a>, 
      <a
    href="http://calc.gregd.org/index.html#Auto Interrupt 3">3</a></td>
  </tr>
  <tr>
    <td width="130">$200</td>
    <td width="191">Disable Keyboard &amp; Below</td>
    <td width="231" align="center"><a href="http://calc.gregd.org/index.html#Auto Interrupt Descriptions">Auto 
      Interrupts</a> <a
    href="http://calc.gregd.org/index.html#Auto Interrupt 1">1</a>, <a href="http://calc.gregd.org/index.html#Auto Interrupt 2">2</a></td>
  </tr>
  <tr>
    <td width="130">$100</td>
    <td width="191">Disable Key Scan</td>
    <td width="231" align="center"><a href="http://calc.gregd.org/index.html#Auto Interrupt Descriptions">Auto 
      Interrupts</a> <a
    href="http://calc.gregd.org/index.html#Auto Interrupt 1">1</a></td>
  </tr>
  <tr>
    <td width="130">$000</td>
    <td width="191">Enable All Interrupts</td>
    <td width="231" align="center">&lt;NONE&gt;</td>
  </tr>
</table>

<p>&nbsp;</p>

<table border="1" width="1110">
  <tr>
    <td colspan="2" width="1104"><h3 align="center"><a name="Auto Interrupt Descriptions">Auto
    Interrupt Descriptions</a></h3>
    </td>
  </tr>
  <tr>
    <td width="128" align="center"><h4><strong>Interrupt Number</strong></h4>
    </td>
    <td width="970" align="center">
      <h4><strong>Description With Respect to the AMS</strong></h4>
    </td>
  </tr>
  <tr>
    <td width="128"><a name="Auto Interrupt 1">Auto Interrupt 1</a></td>
    <td width="970"><strong>Status Line:</strong> By default, it triggers about 395 times per
    second. Draws the status line.</td>
  </tr>
  <tr>
    <td width="128"><a name="Auto Interrupt 2">Auto Interrupt 2</a></td>
    <td width="970"><strong>Keypress:</strong> Triggered when a key is pressed. A single
    keypress can generate multiple interrupts!</td>
  </tr>
  <tr>
    <td width="128"><a name="Auto Interrupt 3">Auto Interrupt 3</a></td>
    <td width="970"><strong>Slow Clock:</strong> Not used by the AMS. Triggers exactly one time per second on HW2 calcs. On HW1 calcs, it triggers ~0.616322 times per second.</td>
  </tr>
  <tr>
    <td width="128"><a name="Auto Interrupt 4">Auto Interrupt 4</a></td>
    <td width="970"><strong>Link:</strong>Triggered by the linking hardware for varoius
    reasons.</td>
  </tr>
  <tr>
    <td width="128"><a name="Auto Interrupt 5">Auto Interrupt 5</a></td>
    <td width="970"><strong>Timers: </strong>Controls the 6<strong> </strong>timers used by
    the TIOS (1-6 inclusive). This interrupt is triggered at 20 times per second if the
    programmable rate generator has not been altered. TIGCC hooks this interrupt to provide
    vector timers.</td>
  </tr>
  <tr>
    <td width="128"><a name="Auto Interrupt 6">Auto Interrupt 6</a></td>
    <td width="970"><strong>ON KEY:</strong> Triggers when the ON KEY is pressed. A single
    keypress can generate multiple interrupts! It also seems to be triggered when battery
    power is low. That explains why doorsos breaks out of programs sometimes when STO is
    pressed.</td>
  </tr>
  <tr>
    <td width="128"><a name="Auto Interrupt 7">Auto Interrupt 7</a></td>
    <td width="970"><strong>Protected Memory Violation:</strong> Triggers when a write is
    attempted at any address below $120 or any address from $E00000 - $FFFFFF. This is to
    prevent damage to the Exception Vector Table from a stack overflow for example. The user
    stack begins at $4BFF and grows backwards to $400, so most of the user vectors will be
    damaged before this interrupt triggers. To avoid this interrupt, you can add $40000 to the
    address that you want to write to. A second method is to clear bit #2 at $600001 to
    disable the interrupt; setting the bit enables the interrupt once again. 
      <p>Notes: The following instructions may be of interest in this interrupt...<br>
        ...<br>
        MOVE USP,A0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;the address to 
        the user stack is in a0<br>
        CMPA.L #$400,A0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;compare with 
        $400<br>
        BHI...&nbsp;&nbsp;&nbsp; ;if higher, then 'Protected Memory Error' is 
        thrown...<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;else 'Memory Error' is Thrown
      <p>Auto Interrupt 7 cannot be disabled via the SR because it is not maskable. 
        Instead, use port .........where did alh's page go =P
    </td>
  </tr>
</table>

<p>&nbsp;</p>
<p>---to do--- clean this up... get rid of ugly table....</p>

<table border="1" width="1110" height="462">
  <tr>
    <td colspan="5" height="22" width="1104"><h3 align="center">Trap Exception Table</h3>
    </td>
  </tr>
  <tr>
    <td width="124" height="19" valign="middle"><h4 align="center"><strong>Trap</strong></h4>
    </td>
    <td width="264" align="center" height="19"><h4><strong>Description</strong></h4>
    </td>
    <td width="164" align="center" height="19"><h4><strong>Input</strong></h4>
    </td>
    <td width="165" align="center" height="19"><h4><strong>Output</strong></h4>
    </td>
    <td width="375" align="center" height="19"><h4><strong>Notes</strong></h4>
    </td>
  </tr>
  <tr>
    <td width="124" height="30" valign="middle"><a name="Trap #0">Trap #0</a>&nbsp;&nbsp;&nbsp;&nbsp;
    ($0)</td>
    <td width="264" height="30">Execute various supervisor mode functions.</td>
    <td width="164" height="30">D0 = function code</td>
    <td width="165" height="30"></td>
    <td width="375" height="30"><table border="0" width="100%">
      <tr>
        <td width="100%" colspan="2"><p align="center"><strong>Known Functions:</strong></td>
      </tr>
      <tr>
        <td width="13%">0</td>
        <td width="87%">sets the power state, switches flash to low power mode</td>
      </tr>
      <tr>
        <td width="13%">1</td>
        <td width="87%">Idle</td>
      </tr>
      <tr>
        <td width="13%">2</td>
        <td width="87%">Clear Break</td>
      </tr>
      <tr>
        <td width="13%">3</td>
        <td width="87%">Check Break</td>
      </tr>
      <tr>
        <td width="13%">4</td>
        <td width="87%">Reset</td>
      </tr>
      <tr>
        <td width="13%">5</td>
        <td width="87%"></td>
      </tr>
      <tr>
        <td width="13%">6</td>
        <td width="87%">Error Lockup</td>
      </tr>
    </table>
    </td>
  </tr>
  <tr>
    <td width="124" height="19" valign="middle"><a name="Trap #1">Trap #1</a>&nbsp;&nbsp;&nbsp;
    ($1)</td>
    <td width="264" height="19">Interrupt Mask</td>
    <td width="164" height="19">D0.w = new interrupt mask</td>
    <td width="165" height="19">D0.l = old SR</td>
    <td width="375" height="19">OSSetSR uses this trap.</td>
  </tr>
  <tr>
    <td width="124" height="17" valign="middle"><a name="Trap #2">Trap #2</a>&nbsp;&nbsp;&nbsp;
    ($2)</td>
    <td width="264" height="17">Reset</td>
    <td width="164" height="17">none</td>
    <td width="165" height="17">The calculator is reset. On ams 2.xx, the archive will be
    intact.</td>
    <td width="375" height="17">Used by Trap #8, so redirect this trap to avoid a reset if you
    use it.</td>
  </tr>
  <tr>
    <td width="124" height="19" valign="middle"><a name="Trap #3">Trap #3</a>&nbsp;&nbsp;&nbsp;
    ($3)</td>
    <td width="264" height="19">OSenqueue</td>
    <td width="164" height="19">parameters on stack C style:<br>
    (short data, void* Queue)</td>
    <td width="165" height="19">D0.w = 1 on success 0 on failure<br>
    Assume that D1-D2/A0-A1 are destroyed</td>
    <td width="375" height="19">This will not work if you want to use OSenqueue 
      becuase OSenqueue expects to be run in user mode. It peforms rts instead 
      of rte at the end of the routine.</td>
  </tr>
  <tr>
    <td width="124" height="19" valign="middle"><a name="Trap #4">Trap #4</a>&nbsp;&nbsp;&nbsp;
    ($4)</td>
    <td width="264" height="19">Turns the calculator off</td>
    <td width="164" height="19"></td>
    <td width="165" height="19">Calculator is off... waits for the ON key to be pressed or a
    link interrupt to turn back on.</td>
    <td width="375" height="19"></td>
  </tr>
  <tr>
    <td width="124" height="19" valign="middle"><a name="Trap #5">Trap #5</a>&nbsp;&nbsp;&nbsp;
    ($5</td>
    <td width="264" height="19">Prints Trap 5 with black bar and hangs</td>
    <td width="164" height="19"></td>
    <td width="165" height="19"></td>
    <td width="375" height="19"></td>
  </tr>
  <tr>
    <td width="124" height="19" valign="middle"><a name="Trap #6&nbsp;">Trap #6&nbsp;</a>&nbsp;&nbsp;
    ($6)</td>
    <td width="264" height="19">Prints Trap 6 with black bar and hangs</td>
    <td width="164" height="19"></td>
    <td width="165" height="19"></td>
    <td width="375" height="19"></td>
  </tr>
  <tr>
    <td width="124" height="19" valign="middle"><a name="Trap #7">Trap #7</a>&nbsp;&nbsp;&nbsp;
    ($7)</td>
    <td width="264" height="19">Prints Trap 7 with black bar and hangs</td>
    <td width="164" height="19"></td>
    <td width="165" height="19"></td>
    <td width="375" height="19"></td>
  </tr>
  <tr>
    <td width="124" height="19" valign="middle"><a name="Trap #8">Trap #8</a>&nbsp;&nbsp;&nbsp;
    ($8)</td>
    <td width="264" height="19">Runs a block in supervisor mode.</td>
    <td width="164" height="19">LE_WORD Size;BYTE Code[];</td>
    <td width="165" height="19">The code is called (passed a5 with the end address), trap #2
    is then called (put on the stack as the return address)</td>
    <td width="375" height="19"></td>
  </tr>
  <tr>
    <td width="124" height="19" valign="middle"><a name="Trap #9">Trap #9</a>&nbsp;&nbsp;&nbsp;
    ($9)</td>
    <td width="264" height="19">Returns pointers to various system functions and tables</td>
    <td width="164" height="19">D0.w = function id</td>
    <td width="165" height="19">A0.l = pointer</td>
    <td width="375" height="19"><table border="0" width="100%">
      <tr>
        <td width="100%" colspan="2"><p align="center"><strong>Input Table</strong></td>
      </tr>
      <tr>
        <td width="21%" align="center"><strong>D0.w</strong></td>
        <td width="79%" align="center"><strong>Pointer</strong></td>
      </tr>
      <tr>
        <td width="21%">0</td>
        <td width="79%">OSContrastUp</td>
      </tr>
      <tr>
        <td width="21%">1</td>
        <td width="79%">WinOpen</td>
      </tr>
      <tr>
        <td width="21%">2</td>
        <td width="79%">OSLinkReset</td>
      </tr>
      <tr>
        <td width="21%">3</td>
        <td width="79%">TIMERV *OSTimerVectors;</td>
      </tr>
      <tr>
        <td width="21%">4</td>
        <td width="79%">BYTE *OSContrast;<br>
        (end of LCD_MEM)</td>
      </tr>
      <tr>
        <td width="21%">5</td>
        <td width="79%">WinStr</td>
      </tr>
      <tr>
        <td width="21%">6</td>
        <td width="79%">KEY_QUEUE *KeyBuffer;</td>
      </tr>
      <tr>
        <td width="21%">7</td>
        <td width="79%">OSqclear</td>
      </tr>
      <tr>
        <td width="21%">8</td>
        <td width="79%">CHARTYPE* CharTbl;</td>
      </tr>
      <tr>
        <td width="21%">9</td>
        <td width="79%">OSContrastUp</td>
      </tr>
      <tr>
        <td width="21%">10</td>
        <td width="79%">OSContrastDn</td>
      </tr>
      <tr>
        <td width="21%">11</td>
        <td width="79%">OSClearBreak</td>
      </tr>
      <tr>
        <td width="21%">12</td>
        <td width="79%">KEYCODE* KeyCodes;</td>
      </tr>
      <tr>
        <td width="21%">13</td>
        <td width="79%">OSCheckBreak</td>
      </tr>
      <tr>
        <td width="21%">14</td>
        <td width="79%">LCD_MEM</td>
      </tr>
      <tr>
        <td width="21%">15</td>
        <td width="79%">OSdequeue</td>
      </tr>
      <tr>
        <td width="21%">16</td>
        <td width="79%">RAMTest</td>
      </tr>
      <tr>
        <td width="21%">17</td>
        <td width="79%">WinMoveTo</td>
      </tr>
    </table>
    </td>
  </tr>
  <tr>
    <td width="124" height="19" valign="middle"><a name="Trap #10">Trap #10</a>&nbsp;&nbsp;&nbsp;
    ($A)</td>
    <td width="264" height="19">Self Test</td>
    <td width="164" height="19"></td>
    <td width="165" height="19"></td>
    <td width="375" height="19"></td>
  </tr>
  <tr>
    <td width="124" height="19" valign="middle"><a name="Trap #11">Trap #11</a>&nbsp;&nbsp;&nbsp;
    ($B)</td>
    <td width="264" height="19">Handles all of the FLASH operations for the operating system.
    This trap needs to execute from the ram if writing is to be peformed.</td>
    <td width="164" height="19">D3 = function number<br>
    D4 = size<br>
    A2 = addr1<br>
    A3 = addr2</td>
    <td width="165" height="19"></td>
    <td width="375" height="19">&nbsp; <table border="0" width="100%">
      <tr>
        <td width="50%" align="center"><strong>D3</strong></td>
        <td width="50%" align="center"><strong>Function</strong></td>
      </tr>
      <tr>
        <td width="50%">0</td>
        <td width="50%">write</td>
      </tr>
      <tr>
        <td width="50%">1</td>
        <td width="50%">erase</td>
      </tr>
      <tr>
        <td width="50%">2</td>
        <td width="50%">addcert</td>
      </tr>
      <tr>
        <td width="50%">3</td>
        <td width="50%">getcert</td>
      </tr>
      <tr>
        <td width="50%">4</td>
        <td width="50%">cgetvernum</td>
      </tr>
    </table>
    <p>If (flen) function is copied and executed in RAM.</td>
  </tr>
  <tr>
    <td width="124" height="19" valign="middle"><a name="Trap #12">Trap #12</a>&nbsp;&nbsp;&nbsp;
    ($C)</td>
    <td width="264" height="19">Enter Supervisor Mode</td>
    <td width="164" height="19">none</td>
    <td width="165" height="19">d0.w contains previous SR upon return.</td>
    <td width="375" height="19">RTE won't work to restore user mode because this trap pop's
    the sr off of the stack and then peforms rts which pops the return address off of the
    stack</td>
  </tr>
  <tr>
    <td width="124" height="19" valign="middle"><a name="Trap #13">Trap #13</a>&nbsp;&nbsp;&nbsp;
    ($D)</td>
    <td width="264" height="19">Prints Trap 13 with black bar and hangs</td>
    <td width="164" height="19"></td>
    <td width="165" height="19"></td>
    <td width="375" height="19"></td>
  </tr>
  <tr>
    <td width="124" height="19" valign="middle"><a name="Trap #14">Trap #14</a>&nbsp;&nbsp;&nbsp;
    ($E)</td>
    <td width="264" height="19">Prints Trap 14 with black bar and hangs</td>
    <td width="164" height="19"></td>
    <td width="165" height="19"></td>
    <td width="375" height="19"></td>
  </tr>
  <tr>
    <td width="124" height="19" valign="middle"><a name="Trap #15">Trap #15</a>&nbsp;&nbsp;&nbsp;
    ($F)</td>
    <td width="264" height="19">Prints ER_throw with black bar and hangs.</td>
    <td width="164" height="19"></td>
    <td width="165" height="19"></td>
    <td width="375" height="19"></td>
  </tr>
</table>

            <p align="center"> <font size="-1" color="red">Copyright &copy; 2000 - <script>document.write(new Date().getFullYear());</script>  by Greg D. All Rights Reserved.</font></p>
          </td>
          <td width="5">
            <!-- spacer column -->
          </td>
          <td valign="top" align="right" width="200"> <table width="100%" bgcolor="BLACK" cellpadding="0">
  <tr>
    <td>
      <table width="100%" border="1" bgcolor="black" bordercolordark="BLACK" bordercolorlight="BLACK" cellspacing="0" cellpadding="2">
        <tr bgcolor="black" bordercolordark="#333333" bordercolorlight="#333333">
          <td background="../templates/GForce_Calc/img.jpg"><b>
            <center>
              <font color="Gold">External Links</font>
            </center>
            </b> </td>
        </tr>
        <tr>
          <td bordercolor="#333333"><a href="http://www.detachedsolutions.com">Detached Solutions</a><br>
<a href="http://www.technoplaza.net/assembly/">Techno-Plaza ASM Lessons</a><br>
<a href="http://tigcc.ticalc.org">TIGCC Cross Compiler</a><br>
<a href="http://www.ticalc.org/">www.ticalc.org</a><br>
<a href="http://www.calc.org/">www.calc.org</a><br>
</td>
        </tr>
      </table>
  </tr>
</table>
<br>
<br><center><img src="../images/default/newlogo.gif" alt="GForce Programming"/></center><br> </td>
          <td width="5">
            <!-- spacer column -->
          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
</body>
</html>
